<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang='en' xml:lang='en' xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>/home/john/.rvm/gems/ruby-1.9.2-p290/gems/actionmailer-3.0.7/lib/action_mailer/base.rb</title>
    <link href="screen.css" media="all" rel="stylesheet" type="text/css" />
    <link href="print.css" media="print" rel="stylesheet" type="text/css" />
    
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8" />
    <script type="text/javascript" src="rcov.js"></script>
  </head>
  <body>
    <h1>Tourmate C0 Coverage Information - RCov</h1>
    <h2>/home/john/.rvm/gems/ruby-1.9.2-p290/gems/actionmailer-3.0.7/lib/action_mailer/base.rb</h2>

    

    <div class="report_table_wrapper">
      <table class='report' id='report_table'>
        <thead>
          <tr>
            <th class="left_align">Name</th>
            <th class="right_align">Total Lines</th>
            <th class="right_align">Lines of Code</th>
            <th class="left_align">Total Coverage</th>
            <th class="left_align">Code Coverage</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="left_align"><a href="-home-john-_rvm-gems-ruby-1_9_2-p290-gems-actionmailer-3_0_7-lib-action_mailer-base_rb.html">/home/john/.rvm/gems/ruby-1.9.2-p290/gems/actionmailer-3.0.7/lib/action_mailer/base.rb</a></td>
            <td class='right_align'><tt>799</tt></td>
            <td class='right_align'><tt>247</tt></td>
            <td class="left_align"><div class="percent_graph_legend"><tt class=''>11.64%</tt></div>
          <div class="percent_graph">
            <div class="covered" style="width:12px"></div>
            <div class="uncovered" style="width:88px"></div>
          </div></td>
            <td class="left_align"><div class="percent_graph_legend"><tt class=''>29.55%</tt></div>
          <div class="percent_graph">
            <div class="covered" style="width:30px"></div>
            <div class="uncovered" style="width:70px"></div>
          </div></td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <h3>Key</h3>
    
    <div class="key"><pre><span class='marked'>Code reported as executed by Ruby looks like this...</span><span class='marked1'>and this: this line is also marked as covered.</span><span class='inferred'>Lines considered as run by rcov, but not reported by Ruby, look like this,</span><span class='inferred1'>and this: these lines were inferred by rcov (using simple heuristics).</span><span class='uncovered'>Finally, here's a line marked as not executed.</span></pre></div>

    <h3>Coverage Details</h3>

    <table class="details">
      <tbody>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line1">1</a> require 'mail'</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line2">2</a> require 'action_mailer/tmail_compat'</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line3">3</a> require 'action_mailer/collector'</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line4">4</a> require 'active_support/core_ext/array/wrap'</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line5">5</a> require 'active_support/core_ext/object/blank'</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line6">6</a> require 'active_support/core_ext/proc'</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line7">7</a> require 'active_support/core_ext/string/inflections'</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line8">8</a> require 'action_mailer/log_subscriber'</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line9">9</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line10">10</a> module ActionMailer #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line11">11</a>   # Action Mailer allows you to send email from your application using a mailer model and views.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line12">12</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line13">13</a>   # = Mailer Models</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line14">14</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line15">15</a>   # To use Action Mailer, you need to create a mailer model.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line16">16</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line17">17</a>   #   $ rails generate mailer Notifier</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line18">18</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line19">19</a>   # The generated model inherits from &lt;tt&gt;ActionMailer::Base&lt;/tt&gt;. Emails are defined by creating methods</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line20">20</a>   # within the model which are then used to set variables to be used in the mail template, to</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line21">21</a>   # change options on the mail, or to add attachments.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line22">22</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line23">23</a>   # Examples:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line24">24</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line25">25</a>   #  class Notifier &lt; ActionMailer::Base</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line26">26</a>   #    default :from =&gt; 'no-reply@example.com',</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line27">27</a>   #            :return_path =&gt; 'system@example.com'</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line28">28</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line29">29</a>   #    def welcome(recipient)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line30">30</a>   #      @account = recipient</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line31">31</a>   #      mail(:to =&gt; recipient.email_address_with_name,</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line32">32</a>   #           :bcc =&gt; [&quot;bcc@example.com&quot;, &quot;Order Watcher &lt;watcher@example.com&gt;&quot;])</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line33">33</a>   #      end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line34">34</a>   #    end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line35">35</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line36">36</a>   # Within the mailer method, you have access to the following methods:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line37">37</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line38">38</a>   # * &lt;tt&gt;attachments[]=&lt;/tt&gt; - Allows you to add attachments to your email in an intuitive</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line39">39</a>   #   manner; &lt;tt&gt;attachments['filename.png'] = File.read('path/to/filename.png')&lt;/tt&gt;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line40">40</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line41">41</a>   # * &lt;tt&gt;attachments.inline[]=&lt;/tt&gt; - Allows you to add an inline attachment to your email</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line42">42</a>   #   in the same manner as &lt;tt&gt;attachments[]=&lt;/tt&gt;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line43">43</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line44">44</a>   # * &lt;tt&gt;headers[]=&lt;/tt&gt; - Allows you to specify any header field in your email such</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line45">45</a>   #   as &lt;tt&gt;headers['X-No-Spam'] = 'True'&lt;/tt&gt;. Note, while most fields like &lt;tt&gt;To:&lt;/tt&gt;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line46">46</a>   #   &lt;tt&gt;From:&lt;/tt&gt; can only appear once in an email header, other fields like &lt;tt&gt;X-Anything&lt;/tt&gt;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line47">47</a>   #   can appear multiple times. If you want to change a field that can appear multiple times,</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line48">48</a>   #   you need to set it to nil first so that Mail knows you are replacing it and not adding</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line49">49</a>   #   another field of the same name.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line50">50</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line51">51</a>   # * &lt;tt&gt;headers(hash)&lt;/tt&gt; - Allows you to specify multiple headers in your email such</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line52">52</a>   #   as &lt;tt&gt;headers({'X-No-Spam' =&gt; 'True', 'In-Reply-To' =&gt; '1234@message.id'})&lt;/tt&gt;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line53">53</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line54">54</a>   # * &lt;tt&gt;mail&lt;/tt&gt; - Allows you to specify email to be sent.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line55">55</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line56">56</a>   # The hash passed to the mail method allows you to specify any header that a Mail::Message</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line57">57</a>   # will accept (any valid Email header including optional fields).</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line58">58</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line59">59</a>   # The mail method, if not passed a block, will inspect your views and send all the views with</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line60">60</a>   # the same name as the method, so the above action would send the +welcome.text.plain.erb+ view</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line61">61</a>   # file as well as the +welcome.text.html.erb+ view file in a +multipart/alternative+ email.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line62">62</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line63">63</a>   # If you want to explicitly render only certain templates, pass a block:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line64">64</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line65">65</a>   #   mail(:to =&gt; user.email) do |format|</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line66">66</a>   #     format.text</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line67">67</a>   #     format.html</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line68">68</a>   #   end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line69">69</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line70">70</a>   # The block syntax is also useful in providing information specific to a part:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line71">71</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line72">72</a>   #   mail(:to =&gt; user.email) do |format|</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line73">73</a>   #     format.text(:content_transfer_encoding =&gt; &quot;base64&quot;)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line74">74</a>   #     format.html</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line75">75</a>   #   end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line76">76</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line77">77</a>   # Or even to render a special view:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line78">78</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line79">79</a>   #   mail(:to =&gt; user.email) do |format|</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line80">80</a>   #     format.text</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line81">81</a>   #     format.html { render &quot;some_other_template&quot; }</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line82">82</a>   #   end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line83">83</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line84">84</a>   # = Mailer views</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line85">85</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line86">86</a>   # Like Action Controller, each mailer class has a corresponding view directory in which each</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line87">87</a>   # method of the class looks for a template with its name.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line88">88</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line89">89</a>   # To define a template to be used with a mailing, create an &lt;tt&gt;.erb&lt;/tt&gt; file with the same</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line90">90</a>   # name as the method in your mailer model. For example, in the mailer defined above, the template at</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line91">91</a>   # &lt;tt&gt;app/views/notifier/signup_notification.text.plain.erb&lt;/tt&gt; would be used to generate the email.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line92">92</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line93">93</a>   # Variables defined in the model are accessible as instance variables in the view.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line94">94</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line95">95</a>   # Emails by default are sent in plain text, so a sample view for our model example might look like this:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line96">96</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line97">97</a>   #   Hi &lt;%= @account.name %&gt;,</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line98">98</a>   #   Thanks for joining our service! Please check back often.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line99">99</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line100">100</a>   # You can even use Action Pack helpers in these views. For example:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line101">101</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line102">102</a>   #   You got a new note!</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line103">103</a>   #   &lt;%= truncate(@note.body, 25) %&gt;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line104">104</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line105">105</a>   # If you need to access the subject, from or the recipients in the view, you can do that through message object:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line106">106</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line107">107</a>   #   You got a new note from &lt;%= message.from %&gt;!</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line108">108</a>   #   &lt;%= truncate(@note.body, 25) %&gt;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line109">109</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line110">110</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line111">111</a>   # = Generating URLs</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line112">112</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line113">113</a>   # URLs can be generated in mailer views using &lt;tt&gt;url_for&lt;/tt&gt; or named routes. Unlike controllers from</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line114">114</a>   # Action Pack, the mailer instance doesn't have any context about the incoming request, so you'll need</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line115">115</a>   # to provide all of the details needed to generate a URL.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line116">116</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line117">117</a>   # When using &lt;tt&gt;url_for&lt;/tt&gt; you'll need to provide the &lt;tt&gt;:host&lt;/tt&gt;, &lt;tt&gt;:controller&lt;/tt&gt;, and &lt;tt&gt;:action&lt;/tt&gt;:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line118">118</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line119">119</a>   #   &lt;%= url_for(:host =&gt; &quot;example.com&quot;, :controller =&gt; &quot;welcome&quot;, :action =&gt; &quot;greeting&quot;) %&gt;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line120">120</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line121">121</a>   # When using named routes you only need to supply the &lt;tt&gt;:host&lt;/tt&gt;:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line122">122</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line123">123</a>   #   &lt;%= users_url(:host =&gt; &quot;example.com&quot;) %&gt;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line124">124</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line125">125</a>   # You want to avoid using the &lt;tt&gt;name_of_route_path&lt;/tt&gt; form of named routes because it doesn't</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line126">126</a>   # make sense to generate relative URLs in email messages.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line127">127</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line128">128</a>   # It is also possible to set a default host that will be used in all mailers by setting the &lt;tt&gt;:host&lt;/tt&gt;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line129">129</a>   # option as a configuration option in &lt;tt&gt;config/application.rb&lt;/tt&gt;:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line130">130</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line131">131</a>   #   config.action_mailer.default_url_options = { :host =&gt; &quot;example.com&quot; }</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line132">132</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line133">133</a>   # Setting &lt;tt&gt;ActionMailer::Base.default_url_options&lt;/tt&gt; directly is now deprecated, use the configuration</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line134">134</a>   # option mentioned above to set the default host.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line135">135</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line136">136</a>   # If you do decide to set a default &lt;tt&gt;:host&lt;/tt&gt; for your mailers you want to use the</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line137">137</a>   # &lt;tt&gt;:only_path =&gt; false&lt;/tt&gt; option when using &lt;tt&gt;url_for&lt;/tt&gt;. This will ensure that absolute URLs are</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line138">138</a>   # generated because the &lt;tt&gt;url_for&lt;/tt&gt; view helper will, by default, generate relative URLs when a</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line139">139</a>   # &lt;tt&gt;:host&lt;/tt&gt; option isn't explicitly provided.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line140">140</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line141">141</a>   # = Sending mail</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line142">142</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line143">143</a>   # Once a mailer action and template are defined, you can deliver your message or create it and save it</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line144">144</a>   # for delivery later:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line145">145</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line146">146</a>   #   Notifier.welcome(david).deliver # sends the email</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line147">147</a>   #   mail = Notifier.welcome(david)  # =&gt; a Mail::Message object</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line148">148</a>   #   mail.deliver                    # sends the email</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line149">149</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line150">150</a>   # You never instantiate your mailer class. Rather, you just call the method you defined on the class itself.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line151">151</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line152">152</a>   # = Multipart Emails</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line153">153</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line154">154</a>   # Multipart messages can also be used implicitly because Action Mailer will automatically</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line155">155</a>   # detect and use multipart templates, where each template is named after the name of the action, followed</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line156">156</a>   # by the content type. Each such detected template will be added as separate part to the message.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line157">157</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line158">158</a>   # For example, if the following templates exist:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line159">159</a>   # * signup_notification.text.plain.erb</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line160">160</a>   # * signup_notification.text.html.erb</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line161">161</a>   # * signup_notification.text.xml.builder</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line162">162</a>   # * signup_notification.text.yaml.erb</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line163">163</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line164">164</a>   # Each would be rendered and added as a separate part to the message, with the corresponding content</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line165">165</a>   # type. The content type for the entire message is automatically set to &lt;tt&gt;multipart/alternative&lt;/tt&gt;,</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line166">166</a>   # which indicates that the email contains multiple different representations of the same email</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line167">167</a>   # body. The same instance variables defined in the action are passed to all email templates.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line168">168</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line169">169</a>   # Implicit template rendering is not performed if any attachments or parts have been added to the email.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line170">170</a>   # This means that you'll have to manually add each part to the email and set the content type of the email</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line171">171</a>   # to &lt;tt&gt;multipart/alternative&lt;/tt&gt;.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line172">172</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line173">173</a>   # = Attachments</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line174">174</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line175">175</a>   # Sending attachment in emails is easy:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line176">176</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line177">177</a>   #   class ApplicationMailer &lt; ActionMailer::Base</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line178">178</a>   #     def welcome(recipient)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line179">179</a>   #       attachments['free_book.pdf'] = File.read('path/to/file.pdf')</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line180">180</a>   #       mail(:to =&gt; recipient, :subject =&gt; &quot;New account information&quot;)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line181">181</a>   #     end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line182">182</a>   #   end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line183">183</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line184">184</a>   # Which will (if it had both a &lt;tt&gt;welcome.text.plain.erb&lt;/tt&gt; and &lt;tt&gt;welcome.text.html.erb&lt;/tt&gt;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line185">185</a>   # template in the view directory), send a complete &lt;tt&gt;multipart/mixed&lt;/tt&gt; email with two parts,</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line186">186</a>   # the first part being a &lt;tt&gt;multipart/alternative&lt;/tt&gt; with the text and HTML email parts inside,</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line187">187</a>   # and the second being a &lt;tt&gt;application/pdf&lt;/tt&gt; with a Base64 encoded copy of the file.pdf book</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line188">188</a>   # with the filename +free_book.pdf+.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line189">189</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line190">190</a>   # = Inline Attachments</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line191">191</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line192">192</a>   # You can also specify that a file should be displayed inline with other HTML. This is useful</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line193">193</a>   # if you want to display a corporate logo or a photo.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line194">194</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line195">195</a>   #   class ApplicationMailer &lt; ActionMailer::Base</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line196">196</a>   #     def welcome(recipient)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line197">197</a>   #       attachments.inline['photo.png'] = File.read('path/to/photo.png')</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line198">198</a>   #       mail(:to =&gt; recipient, :subject =&gt; &quot;Here is what we look like&quot;)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line199">199</a>   #     end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line200">200</a>   #   end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line201">201</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line202">202</a>   # And then to reference the image in the view, you create a &lt;tt&gt;welcome.html.erb&lt;/tt&gt; file and</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line203">203</a>   # make a call to +image_tag+ passing in the attachment you want to display and then call</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line204">204</a>   # +url+ on the attachment to get the relative content id path for the image source:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line205">205</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line206">206</a>   #   &lt;h1&gt;Please Don't Cringe&lt;/h1&gt;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line207">207</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line208">208</a>   #   &lt;%= image_tag attachments['photo.png'].url -%&gt;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line209">209</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line210">210</a>   # As we are using Action View's +image_tag+ method, you can pass in any other options you want:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line211">211</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line212">212</a>   #   &lt;h1&gt;Please Don't Cringe&lt;/h1&gt;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line213">213</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line214">214</a>   #   &lt;%= image_tag attachments['photo.png'].url, :alt =&gt; 'Our Photo', :class =&gt; 'photo' -%&gt;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line215">215</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line216">216</a>   # = Observing and Intercepting Mails</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line217">217</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line218">218</a>   # Action Mailer provides hooks into the Mail observer and interceptor methods.  These allow you to</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line219">219</a>   # register objects that are called during the mail delivery life cycle.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line220">220</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line221">221</a>   # An observer object must implement the &lt;tt&gt;:delivered_email(message)&lt;/tt&gt; method which will be</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line222">222</a>   # called once for every email sent after the email has been sent.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line223">223</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line224">224</a>   # An interceptor object must implement the &lt;tt&gt;:delivering_email(message)&lt;/tt&gt; method which will be</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line225">225</a>   # called before the email is sent, allowing you to make modifications to the email before it hits</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line226">226</a>   # the delivery agents.  Your object should make and needed modifications directly to the passed</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line227">227</a>   # in Mail::Message instance.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line228">228</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line229">229</a>   # = Default Hash</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line230">230</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line231">231</a>   # Action Mailer provides some intelligent defaults for your emails, these are usually specified in a</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line232">232</a>   # default method inside the class definition:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line233">233</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line234">234</a>   #   class Notifier &lt; ActionMailer::Base</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line235">235</a>   #     default :sender =&gt; 'system@example.com'</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line236">236</a>   #   end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line237">237</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line238">238</a>   # You can pass in any header value that a &lt;tt&gt;Mail::Message&lt;/tt&gt; accepts. Out of the box,</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line239">239</a>   # &lt;tt&gt;ActionMailer::Base&lt;/tt&gt; sets the following:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line240">240</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line241">241</a>   # * &lt;tt&gt;:mime_version =&gt; &quot;1.0&quot;&lt;/tt&gt;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line242">242</a>   # * &lt;tt&gt;:charset      =&gt; &quot;UTF-8&quot;,&lt;/tt&gt;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line243">243</a>   # * &lt;tt&gt;:content_type =&gt; &quot;text/plain&quot;,&lt;/tt&gt;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line244">244</a>   # * &lt;tt&gt;:parts_order  =&gt; [ &quot;text/plain&quot;, &quot;text/enriched&quot;, &quot;text/html&quot; ]&lt;/tt&gt;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line245">245</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line246">246</a>   # &lt;tt&gt;parts_order&lt;/tt&gt; and &lt;tt&gt;charset&lt;/tt&gt; are not actually valid &lt;tt&gt;Mail::Message&lt;/tt&gt; header fields,</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line247">247</a>   # but Action Mailer translates them appropriately and sets the correct values.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line248">248</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line249">249</a>   # As you can pass in any header, you need to either quote the header as a string, or pass it in as</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line250">250</a>   # an underscorised symbol, so the following will work:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line251">251</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line252">252</a>   #   class Notifier &lt; ActionMailer::Base</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line253">253</a>   #     default 'Content-Transfer-Encoding' =&gt; '7bit',</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line254">254</a>   #             :content_description =&gt; 'This is a description'</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line255">255</a>   #   end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line256">256</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line257">257</a>   # Finally, Action Mailer also supports passing &lt;tt&gt;Proc&lt;/tt&gt; objects into the default hash, so you</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line258">258</a>   # can define methods that evaluate as the message is being generated:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line259">259</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line260">260</a>   #   class Notifier &lt; ActionMailer::Base</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line261">261</a>   #     default 'X-Special-Header' =&gt; Proc.new { my_method }</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line262">262</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line263">263</a>   #     private</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line264">264</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line265">265</a>   #       def my_method</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line266">266</a>   #         'some complex call'</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line267">267</a>   #       end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line268">268</a>   #   end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line269">269</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line270">270</a>   # Note that the proc is evaluated right at the start of the mail message generation, so if you</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line271">271</a>   # set something in the defaults using a proc, and then set the same thing inside of your</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line272">272</a>   # mailer method, it will get over written by the mailer method.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line273">273</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line274">274</a>   # = Configuration options</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line275">275</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line276">276</a>   # These options are specified on the class level, like</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line277">277</a>   # &lt;tt&gt;ActionMailer::Base.raise_delivery_errors = true&lt;/tt&gt;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line278">278</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line279">279</a>   # * &lt;tt&gt;default&lt;/tt&gt; - You can pass this in at a class level as well as within the class itself as</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line280">280</a>   #   per the above section.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line281">281</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line282">282</a>   # * &lt;tt&gt;logger&lt;/tt&gt; - the logger is used for generating information on the mailing run if available.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line283">283</a>   #   Can be set to nil for no logging. Compatible with both Ruby's own Logger and Log4r loggers.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line284">284</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line285">285</a>   # * &lt;tt&gt;smtp_settings&lt;/tt&gt; - Allows detailed configuration for &lt;tt&gt;:smtp&lt;/tt&gt; delivery method:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line286">286</a>   #   * &lt;tt&gt;:address&lt;/tt&gt; - Allows you to use a remote mail server. Just change it from its default</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line287">287</a>   #     &quot;localhost&quot; setting.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line288">288</a>   #   * &lt;tt&gt;:port&lt;/tt&gt; - On the off chance that your mail server doesn't run on port 25, you can change it.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line289">289</a>   #   * &lt;tt&gt;:domain&lt;/tt&gt; - If you need to specify a HELO domain, you can do it here.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line290">290</a>   #   * &lt;tt&gt;:user_name&lt;/tt&gt; - If your mail server requires authentication, set the username in this setting.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line291">291</a>   #   * &lt;tt&gt;:password&lt;/tt&gt; - If your mail server requires authentication, set the password in this setting.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line292">292</a>   #   * &lt;tt&gt;:authentication&lt;/tt&gt; - If your mail server requires authentication, you need to specify the</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line293">293</a>   #     authentication type here.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line294">294</a>   #     This is a symbol and one of &lt;tt&gt;:plain&lt;/tt&gt; (will send the password in the clear), &lt;tt&gt;:login&lt;/tt&gt; (will</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line295">295</a>   #     send password BASE64 encoded) or &lt;tt&gt;:cram_md5&lt;/tt&gt; (combines a Challenge/Response mechanism to exchange</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line296">296</a>   #     information and a cryptographic Message Digest 5 algorithm to hash important information)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line297">297</a>   #   * &lt;tt&gt;:enable_starttls_auto&lt;/tt&gt; - When set to true, detects if STARTTLS is enabled in your SMTP server</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line298">298</a>   #     and starts to use it.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line299">299</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line300">300</a>   # * &lt;tt&gt;sendmail_settings&lt;/tt&gt; - Allows you to override options for the &lt;tt&gt;:sendmail&lt;/tt&gt; delivery method.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line301">301</a>   #   * &lt;tt&gt;:location&lt;/tt&gt; - The location of the sendmail executable. Defaults to &lt;tt&gt;/usr/sbin/sendmail&lt;/tt&gt;.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line302">302</a>   #   * &lt;tt&gt;:arguments&lt;/tt&gt; - The command line arguments. Defaults to &lt;tt&gt;-i -t&lt;/tt&gt; with &lt;tt&gt;-f sender@addres&lt;/tt&gt;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line303">303</a>   #     added automatically before the message is sent.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line304">304</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line305">305</a>   # * &lt;tt&gt;file_settings&lt;/tt&gt; - Allows you to override options for the &lt;tt&gt;:file&lt;/tt&gt; delivery method.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line306">306</a>   #   * &lt;tt&gt;:location&lt;/tt&gt; - The directory into which emails will be written. Defaults to the application</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line307">307</a>   #     &lt;tt&gt;tmp/mails&lt;/tt&gt;.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line308">308</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line309">309</a>   # * &lt;tt&gt;raise_delivery_errors&lt;/tt&gt; - Whether or not errors should be raised if the email fails to be delivered.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line310">310</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line311">311</a>   # * &lt;tt&gt;delivery_method&lt;/tt&gt; - Defines a delivery method. Possible values are &lt;tt&gt;:smtp&lt;/tt&gt; (default),</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line312">312</a>   #   &lt;tt&gt;:sendmail&lt;/tt&gt;, &lt;tt&gt;:test&lt;/tt&gt;, and &lt;tt&gt;:file&lt;/tt&gt;. Or you may provide a custom delivery method</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line313">313</a>   #   object eg. MyOwnDeliveryMethodClass.new.  See the Mail gem documentation on the interface you need to</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line314">314</a>   #   implement for a custom delivery agent.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line315">315</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line316">316</a>   # * &lt;tt&gt;perform_deliveries&lt;/tt&gt; - Determines whether emails are actually sent from Action Mailer when you</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line317">317</a>   #   call &lt;tt&gt;.deliver&lt;/tt&gt; on an mail message or on an Action Mailer method.  This is on by default but can</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line318">318</a>   #   be turned off to aid in functional testing.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line319">319</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line320">320</a>   # * &lt;tt&gt;deliveries&lt;/tt&gt; - Keeps an array of all the emails sent out through the Action Mailer with</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line321">321</a>   #   &lt;tt&gt;delivery_method :test&lt;/tt&gt;. Most useful for unit and functional testing.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line322">322</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line323">323</a>   # * &lt;tt&gt;default_charset&lt;/tt&gt; - This is now deprecated, use the +default+ method above to</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line324">324</a>   #   set the default +:charset+.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line325">325</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line326">326</a>   # * &lt;tt&gt;default_content_type&lt;/tt&gt; - This is now deprecated, use the +default+ method above</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line327">327</a>   #   to set the default +:content_type+.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line328">328</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line329">329</a>   # * &lt;tt&gt;default_mime_version&lt;/tt&gt; - This is now deprecated, use the +default+ method above</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line330">330</a>   #   to set the default +:mime_version+.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line331">331</a>   #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line332">332</a>   # * &lt;tt&gt;default_implicit_parts_order&lt;/tt&gt; - This is now deprecated, use the +default+ method above</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line333">333</a>   #   to set the default +:parts_order+.  Parts Order is used when a message is built implicitly</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line334">334</a>   #   (i.e. multiple parts are assembled from templates which specify the content type in their</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line335">335</a>   #   filenames) this variable controls how the parts are ordered.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line336">336</a>   class Base &lt; AbstractController::Base</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line337">337</a>     include DeliveryMethods</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line338">338</a>     abstract!</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line339">339</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line340">340</a>     include AbstractController::Logger</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line341">341</a>     include AbstractController::Rendering</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line342">342</a>     include AbstractController::Layouts</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line343">343</a>     include AbstractController::Helpers</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line344">344</a>     include AbstractController::Translation</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line345">345</a>     include AbstractController::AssetPaths</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line346">346</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line347">347</a>     helper  ActionMailer::MailHelper</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line348">348</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line349">349</a>     include ActionMailer::OldApi</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line350">350</a>     include ActionMailer::DeprecatedApi</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line351">351</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line352">352</a>     private_class_method :new #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line353">353</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line354">354</a>     class_attribute :default_params</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line355">355</a>     self.default_params = {</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line356">356</a>       :mime_version =&gt; &quot;1.0&quot;,</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line357">357</a>       :charset      =&gt; &quot;UTF-8&quot;,</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line358">358</a>       :content_type =&gt; &quot;text/plain&quot;,</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line359">359</a>       :parts_order  =&gt; [ &quot;text/plain&quot;, &quot;text/enriched&quot;, &quot;text/html&quot; ]</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line360">360</a>     }.freeze</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line361">361</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line362">362</a>     class &lt;&lt; self</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line363">363</a>       # Register one or more Observers which will be notified when mail is delivered.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line364">364</a>       def register_observers(*observers)</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line365">365</a>         observers.flatten.compact.each { |observer| register_observer(observer) }</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line366">366</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line367">367</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line368">368</a>       # Register one or more Interceptors which will be called before mail is sent.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line369">369</a>       def register_interceptors(*interceptors)</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line370">370</a>         interceptors.flatten.compact.each { |interceptor| register_interceptor(interceptor) }</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line371">371</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line372">372</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line373">373</a>       # Register an Observer which will be notified when mail is delivered.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line374">374</a>       # Either a class or a string can be passed in as the Observer. If a string is passed in</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line375">375</a>       # it will be &lt;tt&gt;constantize&lt;/tt&gt;d.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line376">376</a>       def register_observer(observer)</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line377">377</a>         delivery_observer = (observer.is_a?(String) ? observer.constantize : observer)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line378">378</a>         Mail.register_observer(delivery_observer)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line379">379</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line380">380</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line381">381</a>       # Register an Inteceptor which will be called before mail is sent.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line382">382</a>       # Either a class or a string can be passed in as the Observer. If a string is passed in</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line383">383</a>       # it will be &lt;tt&gt;constantize&lt;/tt&gt;d.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line384">384</a>       def register_interceptor(interceptor)</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line385">385</a>         delivery_interceptor = (interceptor.is_a?(String) ? interceptor.constantize : interceptor)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line386">386</a>         Mail.register_interceptor(delivery_interceptor)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line387">387</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line388">388</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line389">389</a>       def mailer_name</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line390">390</a>         @mailer_name ||= name.underscore</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line391">391</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line392">392</a>       attr_writer :mailer_name</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line393">393</a>       alias :controller_path :mailer_name</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line394">394</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line395">395</a>       def default(value = nil)</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line396">396</a>         self.default_params = default_params.merge(value).freeze if value</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line397">397</a>         default_params</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line398">398</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line399">399</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line400">400</a>       # Receives a raw email, parses it into an email object, decodes it,</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line401">401</a>       # instantiates a new mailer, and passes the email object to the mailer</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line402">402</a>       # object's +receive+ method. If you want your mailer to be able to</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line403">403</a>       # process incoming messages, you'll need to implement a +receive+</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line404">404</a>       # method that accepts the raw email string as a parameter:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line405">405</a>       #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line406">406</a>       #   class MyMailer &lt; ActionMailer::Base</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line407">407</a>       #     def receive(mail)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line408">408</a>       #       ...</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line409">409</a>       #     end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line410">410</a>       #   end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line411">411</a>       def receive(raw_mail)</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line412">412</a>         ActiveSupport::Notifications.instrument(&quot;receive.action_mailer&quot;) do |payload|</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line413">413</a>           mail = Mail.new(raw_mail)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line414">414</a>           set_payload_for_mail(payload, mail)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line415">415</a>           new.receive(mail)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line416">416</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line417">417</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line418">418</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line419">419</a>       # Wraps an email delivery inside of Active Support Notifications instrumentation. This</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line420">420</a>       # method is actually called by the &lt;tt&gt;Mail::Message&lt;/tt&gt; object itself through a callback</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line421">421</a>       # when you call &lt;tt&gt;:deliver&lt;/tt&gt; on the Mail::Message, calling +deliver_mail+ directly</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line422">422</a>       # and passing a Mail::Message will do nothing except tell the logger you sent the email.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line423">423</a>       def deliver_mail(mail) #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line424">424</a>         ActiveSupport::Notifications.instrument(&quot;deliver.action_mailer&quot;) do |payload|</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line425">425</a>           self.set_payload_for_mail(payload, mail)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line426">426</a>           yield # Let Mail do the delivery actions</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line427">427</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line428">428</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line429">429</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line430">430</a>       def respond_to?(method, *args) #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line431">431</a>         super || action_methods.include?(method.to_s)</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line432">432</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line433">433</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line434">434</a>     protected</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line435">435</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line436">436</a>       def set_payload_for_mail(payload, mail) #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line437">437</a>         payload[:mailer]     = self.name</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line438">438</a>         payload[:message_id] = mail.message_id</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line439">439</a>         payload[:subject]    = mail.subject</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line440">440</a>         payload[:to]         = mail.to</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line441">441</a>         payload[:from]       = mail.from</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line442">442</a>         payload[:bcc]        = mail.bcc if mail.bcc.present?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line443">443</a>         payload[:cc]         = mail.cc  if mail.cc.present?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line444">444</a>         payload[:date]       = mail.date</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line445">445</a>         payload[:mail]       = mail.encoded</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line446">446</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line447">447</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line448">448</a>       def method_missing(method, *args) #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line449">449</a>         if action_methods.include?(method.to_s)</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line450">450</a>           new(method, *args).message</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line451">451</a>         else</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line452">452</a>           super</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line453">453</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line454">454</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line455">455</a>     end</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line456">456</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line457">457</a>     attr_internal :message</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line458">458</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line459">459</a>     # Instantiate a new mailer object. If +method_name+ is not +nil+, the mailer</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line460">460</a>     # will be initialized according to the named method. If not, the mailer will</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line461">461</a>     # remain uninitialized (useful when you only need to invoke the &quot;receive&quot;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line462">462</a>     # method, for instance).</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line463">463</a>     def initialize(method_name=nil, *args)</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line464">464</a>       super()</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line465">465</a>       @_message = Mail.new</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line466">466</a>       process(method_name, *args) if method_name</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line467">467</a>     end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line468">468</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line469">469</a>     def process(*args) #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line470">470</a>       lookup_context.skip_default_locale!</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line471">471</a>       super</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line472">472</a>     end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line473">473</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line474">474</a>     class DeprecatedHeaderProxy &lt; ActiveSupport::BasicObject</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line475">475</a>       def initialize(message)</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line476">476</a>         @message = message</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line477">477</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line478">478</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line479">479</a>       def []=(key, value)</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line480">480</a>         unless value.is_a?(::String)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line481">481</a>           ::ActiveSupport::Deprecation.warn(&quot;Using a non-String object for a header's value is deprecated. &quot; \</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line482">482</a>             &quot;You specified #{value.inspect} (a #{value.class}) for #{key}&quot;, caller)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line483">483</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line484">484</a>           value = value.to_s</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line485">485</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line486">486</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line487">487</a>         @message[key] = value</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line488">488</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line489">489</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line490">490</a>       def headers(hash = {})</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line491">491</a>         hash.each_pair do |k,v|</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line492">492</a>           self[k] = v</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line493">493</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line494">494</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line495">495</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line496">496</a>       def method_missing(meth, *args, &amp;block)</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line497">497</a>         @message.send(meth, *args, &amp;block)</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line498">498</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line499">499</a>     end</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line500">500</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line501">501</a>     # Allows you to pass random and unusual headers to the new +Mail::Message+ object</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line502">502</a>     # which will add them to itself.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line503">503</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line504">504</a>     #   headers['X-Special-Domain-Specific-Header'] = &quot;SecretValue&quot;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line505">505</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line506">506</a>     # You can also pass a hash into headers of header field names and values, which</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line507">507</a>     # will then be set on the Mail::Message object:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line508">508</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line509">509</a>     #   headers 'X-Special-Domain-Specific-Header' =&gt; &quot;SecretValue&quot;,</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line510">510</a>     #           'In-Reply-To' =&gt; incoming.message_id</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line511">511</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line512">512</a>     # The resulting Mail::Message will have the following in it's header:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line513">513</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line514">514</a>     #   X-Special-Domain-Specific-Header: SecretValue</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line515">515</a>     def headers(args=nil)</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line516">516</a>       if args</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line517">517</a>         DeprecatedHeaderProxy.new(@_message).headers(args)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line518">518</a>       else</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line519">519</a>         DeprecatedHeaderProxy.new(@_message)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line520">520</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line521">521</a>     end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line522">522</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line523">523</a>     # Allows you to add attachments to an email, like so:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line524">524</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line525">525</a>     #  mail.attachments['filename.jpg'] = File.read('/path/to/filename.jpg')</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line526">526</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line527">527</a>     # If you do this, then Mail will take the file name and work out the mime type</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line528">528</a>     # set the Content-Type, Content-Disposition, Content-Transfer-Encoding and</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line529">529</a>     # base64 encode the contents of the attachment all for you.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line530">530</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line531">531</a>     # You can also specify overrides if you want by passing a hash instead of a string:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line532">532</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line533">533</a>     #  mail.attachments['filename.jpg'] = {:mime_type =&gt; 'application/x-gzip',</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line534">534</a>     #                                      :content =&gt; File.read('/path/to/filename.jpg')}</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line535">535</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line536">536</a>     # If you want to use a different encoding than Base64, you can pass an encoding in,</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line537">537</a>     # but then it is up to you to pass in the content pre-encoded, and don't expect</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line538">538</a>     # Mail to know how to decode this data:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line539">539</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line540">540</a>     #  file_content = SpecialEncode(File.read('/path/to/filename.jpg'))</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line541">541</a>     #  mail.attachments['filename.jpg'] = {:mime_type =&gt; 'application/x-gzip',</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line542">542</a>     #                                      :encoding =&gt; 'SpecialEncoding',</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line543">543</a>     #                                      :content =&gt; file_content }</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line544">544</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line545">545</a>     # You can also search for specific attachments:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line546">546</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line547">547</a>     #  # By Filename</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line548">548</a>     #  mail.attachments['filename.jpg']   # =&gt; Mail::Part object or nil</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line549">549</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line550">550</a>     #  # or by index</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line551">551</a>     #  mail.attachments[0]                # =&gt; Mail::Part (first attachment)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line552">552</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line553">553</a>     def attachments</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line554">554</a>       @_message.attachments</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line555">555</a>     end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line556">556</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line557">557</a>     # The main method that creates the message and renders the email templates. There are</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line558">558</a>     # two ways to call this method, with a block, or without a block.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line559">559</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line560">560</a>     # Both methods accept a headers hash. This hash allows you to specify the most used headers</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line561">561</a>     # in an email message, these are:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line562">562</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line563">563</a>     # * &lt;tt&gt;:subject&lt;/tt&gt; - The subject of the message, if this is omitted, Action Mailer will</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line564">564</a>     #   ask the Rails I18n class for a translated &lt;tt&gt;:subject&lt;/tt&gt; in the scope of</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line565">565</a>     #   &lt;tt&gt;[:actionmailer, mailer_scope, action_name]&lt;/tt&gt; or if this is missing, will translate the</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line566">566</a>     #   humanized version of the &lt;tt&gt;action_name&lt;/tt&gt;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line567">567</a>     # * &lt;tt&gt;:to&lt;/tt&gt; - Who the message is destined for, can be a string of addresses, or an array</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line568">568</a>     #   of addresses.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line569">569</a>     # * &lt;tt&gt;:from&lt;/tt&gt; - Who the message is from</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line570">570</a>     # * &lt;tt&gt;:cc&lt;/tt&gt; - Who you would like to Carbon-Copy on this email, can be a string of addresses,</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line571">571</a>     #   or an array of addresses.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line572">572</a>     # * &lt;tt&gt;:bcc&lt;/tt&gt; - Who you would like to Blind-Carbon-Copy on this email, can be a string of</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line573">573</a>     #   addresses, or an array of addresses.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line574">574</a>     # * &lt;tt&gt;:reply_to&lt;/tt&gt; - Who to set the Reply-To header of the email to.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line575">575</a>     # * &lt;tt&gt;:date&lt;/tt&gt; - The date to say the email was sent on.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line576">576</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line577">577</a>     # You can set default values for any of the above headers (except :date) by using the &lt;tt&gt;default&lt;/tt&gt;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line578">578</a>     # class method:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line579">579</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line580">580</a>     #  class Notifier &lt; ActionMailer::Base</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line581">581</a>     #    self.default :from =&gt; 'no-reply@test.lindsaar.net',</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line582">582</a>     #                 :bcc =&gt; 'email_logger@test.lindsaar.net',</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line583">583</a>     #                 :reply_to =&gt; 'bounces@test.lindsaar.net'</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line584">584</a>     #  end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line585">585</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line586">586</a>     # If you need other headers not listed above, you can either pass them in</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line587">587</a>     # as part of the headers hash or use the &lt;tt&gt;headers['name'] = value&lt;/tt&gt;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line588">588</a>     # method.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line589">589</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line590">590</a>     # When a &lt;tt&gt;:return_path&lt;/tt&gt; is specified as header, that value will be used as the 'envelope from'</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line591">591</a>     # address for the Mail message.  Setting this is useful when you want delivery notifications</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line592">592</a>     # sent to a different address than the one in &lt;tt&gt;:from&lt;/tt&gt;.  Mail will actually use the</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line593">593</a>     # &lt;tt&gt;:return_path&lt;/tt&gt; in preference to the &lt;tt&gt;:sender&lt;/tt&gt; in preference to the &lt;tt&gt;:from&lt;/tt&gt;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line594">594</a>     # field for the 'envelope from' value.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line595">595</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line596">596</a>     # If you do not pass a block to the +mail+ method, it will find all templates in the</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line597">597</a>     # view paths using by default the mailer name and the method name that it is being</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line598">598</a>     # called from, it will then create parts for each of these templates intelligently,</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line599">599</a>     # making educated guesses on correct content type and sequence, and return a fully</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line600">600</a>     # prepared Mail::Message ready to call &lt;tt&gt;:deliver&lt;/tt&gt; on to send.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line601">601</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line602">602</a>     # For example:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line603">603</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line604">604</a>     #   class Notifier &lt; ActionMailer::Base</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line605">605</a>     #     default :from =&gt; 'no-reply@test.lindsaar.net',</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line606">606</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line607">607</a>     #     def welcome</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line608">608</a>     #       mail(:to =&gt; 'mikel@test.lindsaar.net')</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line609">609</a>     #     end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line610">610</a>     #   end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line611">611</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line612">612</a>     # Will look for all templates at &quot;app/views/notifier&quot; with name &quot;welcome&quot;. However, those</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line613">613</a>     # can be customized:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line614">614</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line615">615</a>     #   mail(:template_path =&gt; 'notifications', :template_name =&gt; 'another')</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line616">616</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line617">617</a>     # And now it will look for all templates at &quot;app/views/notifications&quot; with name &quot;another&quot;.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line618">618</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line619">619</a>     # If you do pass a block, you can render specific templates of your choice:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line620">620</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line621">621</a>     #   mail(:to =&gt; 'mikel@test.lindsaar.net') do |format|</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line622">622</a>     #     format.text</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line623">623</a>     #     format.html</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line624">624</a>     #   end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line625">625</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line626">626</a>     # You can even render text directly without using a template:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line627">627</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line628">628</a>     #   mail(:to =&gt; 'mikel@test.lindsaar.net') do |format|</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line629">629</a>     #     format.text { render :text =&gt; &quot;Hello Mikel!&quot; }</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line630">630</a>     #     format.html { render :text =&gt; &quot;&lt;h1&gt;Hello Mikel!&lt;/h1&gt;&quot; }</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line631">631</a>     #   end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line632">632</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line633">633</a>     # Which will render a &lt;tt&gt;multipart/alternative&lt;/tt&gt; email with &lt;tt&gt;text/plain&lt;/tt&gt; and</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line634">634</a>     # &lt;tt&gt;text/html&lt;/tt&gt; parts.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line635">635</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line636">636</a>     # The block syntax also allows you to customize the part headers if desired:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line637">637</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line638">638</a>     #   mail(:to =&gt; 'mikel@test.lindsaar.net') do |format|</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line639">639</a>     #     format.text(:content_transfer_encoding =&gt; &quot;base64&quot;)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line640">640</a>     #     format.html</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line641">641</a>     #   end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line642">642</a>     #</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line643">643</a>     def mail(headers={}, &amp;block)</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line644">644</a>       # Guard flag to prevent both the old and the new API from firing</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line645">645</a>       # Should be removed when old API is removed</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line646">646</a>       @mail_was_called = true</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line647">647</a>       m = @_message</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line648">648</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line649">649</a>       # At the beginning, do not consider class default for parts order neither content_type</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line650">650</a>       content_type = headers[:content_type]</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line651">651</a>       parts_order  = headers[:parts_order]</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line652">652</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line653">653</a>       # Call all the procs (if any)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line654">654</a>       default_values = self.class.default.merge(self.class.default) do |k,v|</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line655">655</a>         v.respond_to?(:call) ? v.bind(self).call : v</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line656">656</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line657">657</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line658">658</a>       # Handle defaults</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line659">659</a>       headers = headers.reverse_merge(default_values)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line660">660</a>       headers[:subject] ||= default_i18n_subject</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line661">661</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line662">662</a>       # Apply charset at the beginning so all fields are properly quoted</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line663">663</a>       m.charset = charset = headers[:charset]</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line664">664</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line665">665</a>       # Set configure delivery behavior</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line666">666</a>       wrap_delivery_behavior!(headers.delete(:delivery_method))</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line667">667</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line668">668</a>       # Assign all headers except parts_order, content_type and body</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line669">669</a>       assignable = headers.except(:parts_order, :content_type, :body, :template_name, :template_path)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line670">670</a>       assignable.each { |k, v| m[k] = v }</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line671">671</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line672">672</a>       # Render the templates and blocks</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line673">673</a>       responses, explicit_order = collect_responses_and_parts_order(headers, &amp;block)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line674">674</a>       create_parts_from_responses(m, responses)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line675">675</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line676">676</a>       # Setup content type, reapply charset and handle parts order</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line677">677</a>       m.content_type = set_content_type(m, content_type, headers[:content_type])</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line678">678</a>       m.charset      = charset</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line679">679</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line680">680</a>       if m.multipart?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line681">681</a>         parts_order ||= explicit_order || headers[:parts_order]</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line682">682</a>         m.body.set_sort_order(parts_order)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line683">683</a>         m.body.sort_parts!</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line684">684</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line685">685</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line686">686</a>       m</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line687">687</a>     end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line688">688</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line689">689</a>   protected</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line690">690</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line691">691</a>     def set_content_type(m, user_content_type, class_default)</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line692">692</a>       params = m.content_type_parameters || {}</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line693">693</a>       case</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line694">694</a>       when user_content_type.present?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line695">695</a>         user_content_type</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line696">696</a>       when m.has_attachments?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line697">697</a>         if m.attachments.detect { |a| a.inline? }</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line698">698</a>           [&quot;multipart&quot;, &quot;related&quot;, params]</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line699">699</a>         else</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line700">700</a>           [&quot;multipart&quot;, &quot;mixed&quot;, params]</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line701">701</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line702">702</a>       when m.multipart?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line703">703</a>         [&quot;multipart&quot;, &quot;alternative&quot;, params]</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line704">704</a>       else</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line705">705</a>         m.content_type || class_default</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line706">706</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line707">707</a>     end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line708">708</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line709">709</a>     def default_i18n_subject #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line710">710</a>       mailer_scope = self.class.mailer_name.gsub('/', '.')</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line711">711</a>       I18n.t(:subject, :scope =&gt; [mailer_scope, action_name], :default =&gt; action_name.humanize)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line712">712</a>     end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line713">713</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line714">714</a>     def collect_responses_and_parts_order(headers) #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line715">715</a>       responses, parts_order = [], nil</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line716">716</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line717">717</a>       if block_given?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line718">718</a>         collector = ActionMailer::Collector.new(lookup_context) { render(action_name) }</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line719">719</a>         yield(collector)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line720">720</a>         parts_order = collector.responses.map { |r| r[:content_type] }</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line721">721</a>         responses  = collector.responses</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line722">722</a>       elsif headers[:body]</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line723">723</a>         responses &lt;&lt; {</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line724">724</a>           :body =&gt; headers.delete(:body),</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line725">725</a>           :content_type =&gt; self.class.default[:content_type] || &quot;text/plain&quot;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line726">726</a>         }</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line727">727</a>       else</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line728">728</a>         templates_path = headers.delete(:template_path) || self.class.mailer_name</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line729">729</a>         templates_name = headers.delete(:template_name) || action_name</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line730">730</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line731">731</a>         each_template(templates_path, templates_name) do |template|</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line732">732</a>           self.formats = template.formats</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line733">733</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line734">734</a>           responses &lt;&lt; {</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line735">735</a>             :body =&gt; render(:template =&gt; template),</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line736">736</a>             :content_type =&gt; template.mime_type.to_s</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line737">737</a>           }</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line738">738</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line739">739</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line740">740</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line741">741</a>       [responses, parts_order]</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line742">742</a>     end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line743">743</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line744">744</a>     def each_template(paths, name, &amp;block) #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line745">745</a>       Array.wrap(paths).each do |path|</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line746">746</a>         templates = lookup_context.find_all(name, path)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line747">747</a>         templates = templates.uniq_by { |t| t.formats }</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line748">748</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line749">749</a>         unless templates.empty?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line750">750</a>           templates.each(&amp;block)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line751">751</a>           return</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line752">752</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line753">753</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line754">754</a>     end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line755">755</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line756">756</a>     def create_parts_from_responses(m, responses) #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line757">757</a>       if responses.size == 1 &amp;&amp; !m.has_attachments?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line758">758</a>         responses[0].each { |k,v| m[k] = v }</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line759">759</a>       elsif responses.size &gt; 1 &amp;&amp; m.has_attachments?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line760">760</a>         container = Mail::Part.new</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line761">761</a>         container.content_type = &quot;multipart/alternative&quot;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line762">762</a>         responses.each { |r| insert_part(container, r, m.charset) }</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line763">763</a>         m.add_part(container)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line764">764</a>       else</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line765">765</a>         responses.each { |r| insert_part(m, r, m.charset) }</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line766">766</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line767">767</a>     end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line768">768</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line769">769</a>     def insert_part(container, response, charset) #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line770">770</a>       response[:charset] ||= charset</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line771">771</a>       part = Mail::Part.new(response)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line772">772</a>       container.add_part(part)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line773">773</a>     end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line774">774</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line775">775</a>     module DeprecatedUrlOptions</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line776">776</a>       def default_url_options</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line777">777</a>         deprecated_url_options</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line778">778</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line779">779</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line780">780</a>       def default_url_options=(val)</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line781">781</a>         deprecated_url_options</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line782">782</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line783">783</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line784">784</a>       def deprecated_url_options</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line785">785</a>         raise &quot;You can no longer call ActionMailer::Base.default_url_options &quot; \</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line786">786</a>               &quot;directly. You need to set config.action_mailer.default_url_options. &quot; \</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line787">787</a>               &quot;If you are using ActionMailer standalone, you need to include the &quot; \</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line788">788</a>               &quot;routing url_helpers directly.&quot;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line789">789</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line790">790</a>     end</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line791">791</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line792">792</a>     # This module will complain if the user tries to set default_url_options</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line793">793</a>     # directly instead of through the config object. In Action Mailer's Railtie,</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line794">794</a>     # we include the router's url_helpers, which will override this module.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line795">795</a>     extend DeprecatedUrlOptions</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line796">796</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line797">797</a>     ActiveSupport.run_load_hooks(:action_mailer, self)</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line798">798</a>   end</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line799">799</a> end</pre></td>
          </tr>
        
      </tbody>
    </table>

    <p>Generated on 2011-10-27 12:30:25 +0530 with <a href="http://github.com/relevance/rcov">rcov 0.9.11</a></p>

  </body>
</html>
